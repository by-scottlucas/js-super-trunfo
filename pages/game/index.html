<!DOCTYPE html>
<html lang="pt-br">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <link rel="stylesheet" href="./style.css">
    <link rel="stylesheet" href="../../styles/global.css">
    <link rel="icon" href="../../assets/images/icon-mk11.png">
    <link rel="manifest" href="./manifest.json">
    <title>Super Trunfo | Game</title>
</head>

<body>

    <main class="container">

        <button class="sound-btn" id="open-modal">
            <img src="../../assets/images/icon-sound.png" alt="icon-sound" class="icon-sound">
        </button>

        <!-- Modal Volume -->
        <div class="modal-overlay" id="music-modal">
            <div class="modal-box music-box">
                <div class="modal-content music-content">

                    <img src="../../assets/images/icon-mk11.png" alt="logotipo" class="logo-modal music-logo">

                    <div class="volume-box">
                        <p class="title-volume-range">Volume da música</p>
                        <input type="range" id="volume-range" class="volume-range" min="0" max="1" step="0.01"
                            value="0.5">

                        <button class="play-again-btn btn-confirma-volume" onclick="closeModal()">
                            Confirmar
                        </button>
                    </div>

                    <audio id="game-music" loop>
                        <source src="../../assets/sounds/MK11_Main_Theme.mp3" type="audio/mpeg">
                        Your browser does not support the audio element.
                    </audio>

                </div>
            </div>
        </div>

        <section class="cartas" id="cartas">
            <div onclick="pegarCarta()" id="subzero" class="card-box">
                <img src="../../assets/images/01.webp" alt="subzero" class="card">
                <input type="radio" name="card" value="subzero" class="input-card">
            </div>
            <div onclick="pegarCarta()" id="scorpion" class="card-box">
                <img src="../../assets/images/02.webp" alt="scorpion" class="card">
                <input type="radio" name="card" value="scorpion" class="input-card">
            </div>
            <div onclick="pegarCarta()" id="raiden" class="card-box">
                <img src="../../assets/images/03.webp" alt="raiden" class="card">
                <input type="radio" name="card" value="raiden" class="input-card">
            </div>
            <div onclick="pegarCarta()" id="liuKang" class="card-box">
                <img src="../../assets/images/04.webp" alt="liu kang" class="card">
                <input type="radio" name="card" value="liuKang" class="input-card">
            </div>
            <div onclick="pegarCarta()" id="kungLao" class="card-box">
                <img src="../../assets/images/05.webp" alt="kung lao" class="card">
                <input type="radio" name="card" value="kungLao" class="input-card">
            </div>
            <div onclick="pegarCarta()" id="mileena" class="card-box">
                <img src="../../assets/images/06.webp" alt="mileena" class="card">
                <input type="radio" name="card" value="mileena" class="input-card">
            </div>
            <div onclick="pegarCarta()" id="kitana" class="card-box">
                <img src="../../assets/images/07.webp" alt="kitana" class="card">
                <input type="radio" name="card" value="kitana" class="input-card">
            </div>
            <div onclick="pegarCarta()" id="frost" class="card-box">
                <img src="../../assets/images/08.webp" alt="frost" class="card">
                <input type="radio" name="card" value="frost" class="input-card">
            </div>
            <div onclick="pegarCarta()" id="cassieCage" class="card-box">
                <img src="../../assets/images/09.webp" alt="cassie cage" class="card">
                <input type="radio" name="card" value="cassieCage" class="input-card">
            </div>
            <div onclick="pegarCarta()" id="jacquiBriggs" class="card-box">
                <img src="../../assets/images/10.webp" alt="jacqui briggs" class="card">
                <input type="radio" name="card" value="jacquiBriggs" class="input-card">
            </div>
        </section>

        <section class="game-box" id="game-box" style="display: none;">
            <div class="cards-battle">
                <div class="card1">
                    <div id="card1"></div>
                    <p id="atributos1"></p>
                </div>
                <img src="../../assets/images/vs-logo.png" class="vs">
                <div class="card2">
                    <div id="card2"></div>
                    <p id="atributos2"></p>
                </div>
            </div>

            <div class="atributos" id="atributos">
                <div class="atributo-option" onclick="pegarAtributo()">
                    <input type="radio" name="atributos" value="Força" class="atributo">
                    <div class="atributo-btn">
                        <p>Força</p>
                    </div>
                </div>

                <div class="atributo-option" onclick="pegarAtributo()">
                    <input type="radio" name="atributos" value="Agilidade" class="atributo">
                    <div class="atributo-btn">
                        <p>Agilidade</p>
                    </div>
                </div>

                <div class="atributo-option" onclick="pegarAtributo()">
                    <input type="radio" name="atributos" value="Magia" class="atributo">
                    <div class="atributo-btn">
                        <p>Magia</p>
                    </div>
                </div>

                <div class="atributo-option" onclick="pegarAtributo()">
                    <input type="radio" name="atributos" value="Combate" class="atributo">
                    <div class="atributo-btn">
                        <p>Combate</p>
                    </div>
                </div>
            </div>

            <button class="fight-btn" id="fight-btn" onclick="fight()">Fight</button>
        </section>
    </main>

    <div class="modal-overlay" id="message-modal">
        <div class="modal-box">

            <div class="modal-content">
                <img src="../../assets/images/icon-mk11.png" alt="logotipo" class="logo-modal">

                <p id="atributo-selected"></p>
                <p id="atributos-points"></p>
                <p id="player-ganhador"></p>

                <button class="play-again-btn" style="display: none;" id="play-again" onclick="playAgain()">
                    Jogar Novamente
                </button>

            </div>

        </div>
    </div>

    <script src="../../scripts/script.js"></script>

    <script>
        // Função para fechar o modal de ajuste de volume
        function closeModal() {
            const modal = document.getElementById('music-modal');
            modal.style.display = 'none';
        }

        // Registro do Service Worker para cache e offline mode
        if ('serviceWorker' in navigator) {
            window.addEventListener('load', () => {
                navigator.serviceWorker.register('/js-super-trunfo/utils/service-worker.js').then(registration => {
                    console.log('Service Worker registrado com sucesso:', registration);
                }).catch(error => {
                    console.error('Falha ao registrar o Service Worker:', error);
                });
            });
        }

        // Quando o DOM estiver completamente carregado
        document.addEventListener('DOMContentLoaded', (event) => {
            const savedVolume = localStorage.getItem('gameVolume');
            const audio = document.getElementById('game-music');
            const volumeRange = document.getElementById('volume-range');

            // Define o volume inicial a partir do localStorage ou padrão para 0.5
            if (savedVolume) {
                audio.volume = savedVolume;
                volumeRange.value = savedVolume;
            } else {
                audio.volume = 0.5;
                volumeRange.value = 0.5;
            }

            // Toca o áudio ao carregar a página
            audio.play().catch(error => {
                console.error('Falha ao reproduzir áudio:', error);
            });

            // Event listener para ajuste de volume
            volumeRange.addEventListener('input', function () {
                audio.volume = this.value;
                localStorage.setItem('gameVolume', this.value);
            });

            // Abre o modal de ajuste de volume ao clicar no botão
            const openModalBtn = document.getElementById('open-modal');
            const modal = document.getElementById('music-modal');
            openModalBtn.addEventListener('click', () => {
                modal.style.display = 'block'; // Garante que o modal seja exibido corretamente
            });

            // Fecha o modal se o usuário clicar fora dele
            window.onclick = function (event) {
                if (event.target === modal) {
                    modal.style.display = 'none';
                }
            };
        });
    </script>

</body>

</html>